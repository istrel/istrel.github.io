<!DOCTYPE html>
<html lang="en">
<head>
  <title>Как не надо тестировать</title>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="shower/themes/ribbon/styles/screen-16x10.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/docco.min.css"> -->
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/color-brewer.min.css"> -->
  <link rel="stylesheet" href="highlight/idea.min.css">
  <style>
    .slide pre code {
      line-height: 1.4;
      margin-top: -1em;
      margin-bottom: -1em;
    }
  </style>
</head>
<body class="shower list">
  <header class="caption">
    <h1>Как не надо тестировать</h1>
    <p>Иван Стрелков</p>
  </header>
  <section class="slide cover" id="Cover"><div>
    <h2>Как не надо тестировать</h2>
    <p>
      <a href="https://github.com/istrel">Иван Стрелков</a>
      <div class="table">
        <div class="row">
          <div class="cell">
            <img class="fronttalks-logo" src="pictures/fronttalks-logo.png">
          </div>
          <div class="cell">
            <img class="avito-logo" src="pictures/logo-avito.svg">
          </div>
        </div>
      </div>
    </p>
    <!--
      To apply styles to the certain slides
      set slide ID to get needed elements
      -->
    <style>
      #Cover h2 {
        margin:30px 0 0;
        color:#000;
        text-align:center;
        font-size:70px;
        }
      #Cover p {
        margin:10px 0 0;
        text-align:center;
        color:#000;
        font-style:italic;
        font-size:20px;
        }
        #Cover a {
          color:#000;
          font-size: xx-large;
          }

      #Cover {
        background: white;
      }
      .fronttalks-logo {
        position: relative;
        width: 200px;
        height: 200px;
      }
      .avito-logo {
        height: 112px;
        width: 322px;
      }

      pre code {
        font-size: 21px;
      }

      .table {
        margin-top: 1em;
        width: 100%;
        display: table;
      }
      .row {
        display: table-row;
      }
      .cell {
        text-align: center;
        vertical-align: middle;
        display: table-cell;
      }
    </style>
  </div></section>
  <section class="slide"><div>
    <h2 class="shout">Тестирование</h2>
  </div></section>
  <section class="slide"><div>
    <h2 class="shout">Люди, которые пишут тесты</h2>
  </div></section>
  <section class="slide"><div>
    <h2 class="shout">Путь тестирования</h2>
  </div></section>
  <section class="slide"><div>
    <h2>Шаг 0. Вызов</h2>
    <ul>
      <li class="next">
        Статья на хабре
      </li>
      <li class="next">
        Книга про тестирование <span class="next">на Java</span><span class="next"> или на Ruby</span>
      </li>
      <li class="next">
        Доклады (<a href="https://www.youtube.com/watch?v=dfYZ6QejnnM">Три истории о тестировании</a>)
      </li>
      <li class="next">
        Менеджер/Тимлид/etc, который заставляет писать тесты
      </li>
    </ul>
  </div></section>
  <section class="slide"><div>
    <h2>Шаг 1. Начало</h2>
    <ul>
      <li class="next">
        Начинаем писать тесты к написанному коду
      </li>
      <li class="next">
        Через тернии пытаемся писать TDD
      </li>
      <li class="next">
        Не понимаем, но терпим
      </li>
    </ul>
  </div></section>
  <section class="slide"><div>
    <h2>Шаг 2. Принятие</h2>
    <ul>
      <li class="next">
        Пишем больше модульных тестов
      </li>
      <li class="next">
        Иногда отлавливаем ошибки
      </li>
      <li class="next">
        Уже разобрались с тестами
      </li>
    </ul>
  </div></section>
  <section class="slide"><div>
    <h2>Шаг 3. Test all the things!</h2>
    <ul>
      <li class="next">
        Пишем тесты на всё
      </li>
      <li class="next">
        Ощущаем легкость в написании тестов
      </li>
    </ul>
  </div></section>
  <section class="slide" id="pain"><div>
    <h2 class="shout">Шаг 4. Боль</h2>
    <style>
      #pain h2 {
        color: white;
      }
      #pain {
        background: red;
      }
    </style>
  </div></section>
  <section class="slide"><div>
    <h2>Шаг 4. Боль</h2>
    <ul>
      <li class="next">
        Баги все равно появляются
      </li>
      <li class="next">
        Тесты во много раз затратнее, чем код
      </li>
      <li class="next">
        "Я занимаюсь какой-то фигней"
      </li>
      <li class="next">
        "Ты слишком много времени тратишь на тесты"
      </li>
    </ul>
  </div></section>
  <section class="slide"><div>
    <h2 class="shout">Вредные тесты</h2>
  </div></section>
  <section class="slide">
    <h2>О чем доклад?</h2>
    Антипаттерны тестирования:
    <ol>
      <li>Тестирование статики</li>
      <li>Тесты-близнецы</li>
      <li>Слишком сложный тест:
        <ul>
          <li>Верстка и сеть</li>
          <li>Асинхронный код</li>
        </ul>
      </li>
    </ol>
  </section>
  <section class="slide"><div>
    <h2 class="shout">Тестирование статики</h2>
  </div></section>
  <section class="slide">
    <h2>Тестирование статики - Тест</h2>
    <pre>
      <code class="javascript">
describe('VideoView', () => {
  it('is editable', () => {
    expect(<mark>new VideoView().editable</mark>).toBe(<mark>true</mark>);
  });
});
      </code>
    </pre>
  </section>
  <section class="slide">
    <h2>Тестирование статики - Код</h2>
    <pre>
      <code class="javascript">
class VideoView extends GenericView {
  <mark>editable = true;</mark>

  <span class="comment">// ...</span>
}
      </code>
    </pre>
    <span class="next">Тестируются статические данные</span>
  </section>
  <section class="slide">
    <h2>Тестирование статики - Причины</h2>
    <ol>
      <li class="next">
        "Нужно покрыть любой новый код тестами"
        <ul>
          <li class="next">
            Выбросить тест
          </li>
        </ul>
      </li>
      <li class="next">
        Функционал зависит от статики
        <ul>
          <li class="next">
            Протестировать функционал, зависящий от статики
          </li>
        </ul>
      </li>
    </ol>
  </section>
  <section class="slide">
    <h2>Тестирование статики - Правильный тест</h2>
    <ol>
      <li class="next">
        Флаг editable - документируемый флаг GenericView (родителя)
        <ul>
          <li>Проверить, что если флаг указан, показана кнопка редактирования</li>
          <li>Проверить, что если флаг не указан, спрятана кнопка редактирования</li>
        </ul>
      </li>
      <li class="next">
        Флаг editable был создан специально для VideoView
        <ul>
          <li>Проверить, что при нажатии на кнопку, показывается форма</li>
          <li>Проверить, что форма редактирования сохраняет введенные данные</li>
        </ul>
      </li>
    </ul>
  </section>
  <section class="slide">
    <h2>Тестирование статики - Правильный тест</h2>
    <pre><code class="javascript">
describe('GenericView', () => {
  it('disallows editing by default', () => {
    var view = new GenericView();
    expect(() => { view.edit(); }).toThrow();
  });

  it('allows editing via specifying "editable" flag', () => {
    var view = new GenericView({ editable: true });
    expect(() => { view.edit(); }).not.toThrow();
  });
});
    </code></pre>
    <p class="note">Применим в случае если editable - документированный флаг</p>
  </section>
  <section class="slide">
     <h2>Тестирование статики - Правильный тест</h2>
     <pre><code class="javascript">
describe('VideoView', () => {
  describe('editing', () => {
    beforeEach(() => {
      this.view = new VideoView();
      this.view.edit();
    });
    it('opens editing popup', () => {
      expect(this.view.$el.find('.editing-popup').length).toBe(1);
    });
    it('saves on editing', () => {
      this.view.$el.find('.title').val('new value').change();
      this.view.$el.find('.save').click();
      expect(this.view.model.get('title')).toBe('new value');
    });
});
     </code></pre>
     <p class="note">Применим в случае если editable создан только для VideoView</p>
  </section>
  <section class="slide">
    <h2>Тестирование статики - Опасность</h2>
    <img src="pictures/static-danger.png" alt="" class="cover">
  </section>
  <section class="slide"><div>
    <h2 class="shout">Тест-близнец</h2>
  </div></section>
  <section class="slide"><div>
    <h2 class="shout">a.k.a. Mockery</h2>
  </div></section>
  <section class="slide">
    <h2>Тест-близнец - Stub/Mock</h2>
      Стаб или мок - метод, который заменяет настоящий метод и при этом следит за тем, как его вызывают.
    <pre><code style="margin-top: 2em;" class="javascript">
it('performs ajax call to /rest/images', () => {
  sinon.stub(jQuery, 'ajax');

  fetchImages();

  assert(jQuery.ajax.calledWith('/rest/images'));
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Код</h2>
    <pre><code class="javascript">
module.exports = {
  build() {
    firstLib.clean('build')
      .then(() => secondLib.compileJS('src', 'build'))
      .then(() => thirdLib.optimizeCSS())
  }
};
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Код</h2>
    <pre><code class="javascript">
module.exports = {
  build() {
    <mark>firstLib.clean('build')</mark>                               // очистка
      .then(() => secondLib.compileJS('src', 'build'))
      .then(() => thirdLib.optimizeCSS())
  }
};
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Код</h2>
    <pre><code class="javascript">
module.exports = {
  build() {
    firstLib.clean('build')
      .then(() => <mark>secondLib.compileJS('src', 'build')</mark>)    // JS
      .then(() => thirdLib.optimizeCSS())
  }
};
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Код</h2>
    <pre><code class="javascript">
module.exports = {
  build() {
    firstLib.clean('build')
      .then(() => secondLib.compileJS('src', 'build'))
      .then(() => <mark>thirdLib.optimizeCSS()</mark>)                 // CSS
  }
};
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('build step', () => {
  beforeEach(() => {
    // Подменяем библиотечные методы моками с resolved promises
    buildSystem.build();
  });

  it('builds, compiles and does something else', () => {
    assert(firstLib.clean.calledWith('build'));

    assert(secondLib.compileJS.calledWith('src', 'build'));

    assert(thirdLib.optimizeCSS.called);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('build step', () => {
  beforeEach(() => {
    <mark>// Подменяем библиотечные методы моками с resolved promises</mark>
    buildSystem.build();
  });

  it('builds, compiles and does something else', () => {
    assert(firstLib.clean.calledWith('build'));

    assert(secondLib.compileJS.calledWith('src', 'build'));

    assert(thirdLib.optimizeCSS.called);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('build step', () => {
  beforeEach(() => {
    // Подменяем библиотечные методы моками с resolved promises
    <mark>buildSystem.build();</mark>
  });

  it('builds, compiles and does something else', () => {
    assert(firstLib.clean.calledWith('build'));

    assert(secondLib.compileJS.calledWith('src', 'build'));

    assert(thirdLib.optimizeCSS.called);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('build step', () => {
  beforeEach(() => {
    // Подменяем библиотечные методы моками с resolved promises
    buildSystem.build();
  });

  it('builds, compiles and does something else', () => {
    assert(<mark>firstLib.clean</mark>.calledWith(<mark>'build'</mark>));             // очистка

    assert(secondLib.compileJS.calledWith('src', 'build'));

    assert(thirdLib.optimizeCSS.called);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('build step', () => {
  beforeEach(() => {
    // Подменяем библиотечные методы моками с resolved promises
    buildSystem.build();
  });

  it('builds, compiles and does something else', () => {
    assert(firstLib.clean.calledWith('build'));

    assert(<mark>secondLib.compileJS</mark>.calledWith(<mark>'src', 'build'</mark>)); // JS

    assert(thirdLib.optimizeCSS.called);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('build step', () => {
  beforeEach(() => {
    // Подменяем библиотечные методы моками с resolved promises
    buildSystem.build();
  });

  it('builds, compiles and does something else', () => {
    assert(firstLib.clean.calledWith('build'));

    assert(secondLib.compileJS.calledWith('src', 'build'));

    assert(<mark>thirdLib.optimizeCSS</mark>.called);                    // CSS
  });
});
    </code></pre>
    <div class="next" style="margin-top: -2em;">Полное повторение структуры кода в тесте</div>
  </section>
  <section class="slide">
    <img src="pictures/test-script.jpg" alt="" class="cover">
  </section>
  <section class="slide">
    <h2>Декларативный тест-близнец - Код</h2>
    <pre><code class="html">
class HomePage extends React.Component {
  render() {
    return (
      &lt;div&gt;
        &lt;Header userName={this.props.userName} /&gt;
        &lt;Content&gt; {this.props.invitation} &lt;/Content&gt;
        &lt;Footer showSocial /&gt;
      &lt;/div&gt;
    )
  }
}
    </code></pre>
  </section>
  <section class="slide">
    <h2>Декларативный тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('HomePage', () => {
  beforeEach(() => { /* &lt;HomePage <mark>userName="vasya" invitation="hello"</mark>/&gt; */ });
  it('renders header with userName', () => {
    let header = TestUtils.findRenderedComponent(this.homePage, Header);
    expect(header.props.userName).toBe('vasya');
  });
  it('renders footer', () => {
    let footer = TestUtils.findRenderedComponent(this.homePage, Footer);
    expect(footer.props.showSocial).toBe(true);
  });
  it('renders invitation', () => {
    expect(this.container.innerHTML).toContain('hello');
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Декларативный тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('HomePage', () => {
  beforeEach(() => { /* &lt;HomePage userName="vasya" invitation="hello"/&gt; */ });
  it('renders header with userName', () => {
    let header = TestUtils.findRenderedComponent(this.homePage, Header);
    expect(<mark>header.props.userName</mark>).toBe(<mark>'vasya'</mark>);
  });
  it('renders footer', () => {
    let footer = TestUtils.findRenderedComponent(this.homePage, Footer);
    expect(footer.props.showSocial).toBe(true);
  });
  it('renders invitation', () => {
    expect(this.container.innerHTML).toContain('hello');
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Декларативный тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('HomePage', () => {
  beforeEach(() => { /* &lt;HomePage userName="vasya" invitation="hello"/&gt; */ });
  it('renders header with userName', () => {
    let header = TestUtils.findRenderedComponent(this.homePage, Header);
    expect(header.props.userName).toBe('vasya');
  });
  it('renders footer', () => {
    let footer = TestUtils.findRenderedComponent(this.homePage, Footer);
    expect(<mark>footer.props.showSocial</mark>).toBe(<mark>true</mark>);
  });
  it('renders invitation', () => {
    expect(this.container.innerHTML).toContain('hello');
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Декларативный тест-близнец - Тест</h2>
    <pre><code class="javascript">
describe('HomePage', () => {
  beforeEach(() => { /* &lt;HomePage userName="vasya" invitation="hello"/&gt; */ });
  it('renders header with userName', () => {
    let header = TestUtils.findRenderedComponent(this.homePage, Header);
    expect(header.props.userName).toBe('vasya');
  });
  it('renders footer', () => {
    let footer = TestUtils.findRenderedComponent(this.homePage, Footer);
    expect(footer.props.showSocial).toBe(true);
  });
  it('renders invitation', () => {
    expect(<mark>this.container.innerHTML</mark>).toContain(<mark>'hello'</mark>);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Причины</h2>
    <ol>
      <li class="next">
        "Тестировать изолированные модули в замоканной среде"
        <ul>
          <li class="next">Выбросить тест</li>
          <li class="next">Переписать на функциональный</li>
          <li class="next">Тестировать полезный результат</li>
        </ul>
      </li>
      <li class="next">
        Достижение максимального coverage
        <ul>
          <li class="next">Выбросить тест</li>
        </ul>
      </li>
      <li class="next">
        Четкое следование методологии TDD
        <ul>
          <li class="next">Выбросить тест сейчас, но вернуть потом</li>
        </ul>
      </li>
    </ol>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Правильный тест</h2>
    Протестировать наличие в компоненте иконки Twitter
    <pre><code class="html">
class HomePage extends React.Component {
  render() {
    return (
      &lt;div&gt;
        &lt;Header userName={this.props.userName} /&gt;
        &lt;Content children={this.props.invitation} /&gt;
        &lt;Footer showSocial /&gt;
      &lt;/div&gt;
    )
  }
}
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Правильный тест</h2>
    <pre><code class="javascript">
describe('HomePage', () => {
  beforeEach(() => { /* &lt;HomePage userName="vasya" invitation="hello"/&gt; */ });
  it('renders social icons', () => {
    let twitterIcon =
      this.container.querySelector('a[href^="https://twitter.com"]');

    expect(twitterIcon).not.toBe(null);
  });
});
    </code></pre>
  </section>
  <section class="slide">
    <h2>Тест-близнец - Опасность</h2>
    <img src="pictures/twin-flux/twin-flux.001.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.002.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.003.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.004.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.005.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.006.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.007.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.008.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.009.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.010.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.011.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <h2>Тест-близнец - А как надо?</h2>
    <img src="pictures/twin-flux/twin-flux.012.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.013.jpeg" alt="" class="cover">
  </section>
  <section class="slide">
    <img src="pictures/twin-flux/twin-flux.015.jpeg" alt="" class="cover">
  </section>
  <section class="slide"><div>
    <h2 class="shout">Слишком <br> сложный <br> тест</h2>
  </div></section>
  <section class="slide">
    <h2>Особенности тестирования фронтенда</h2>
    <ol>
      <li class="next">Не только JS, но и HTML/CSS</li>
      <li class="next">Взаимодействие с пользователем</li>
      <li class="next">Взаимодействие с сервером</li>
      <li class="next">Асинхронность</li>
    </ol>
  </section>
  <section class="slide"><div>
    <h2 class="shout">Верстка и сеть</h2>
  </div></section>
  <section class="slide" id="ko" style="background-color: #efedef">
    <h2>Верстка и сеть - Задача</h2>
    <center>
      <img src="pictures/task.gif" width="670"/>
    </center>
    <span style="position: absolute; top: 238px; left: 130px; color: red; font-weight: bold;">
      ContactsViewModel
    </span>
  </section>
  <section class="slide">
    <h2>Верстка и сеть - Тест</h2>
    <ol style="margin-top: -0.5em;">
      <li class="next">Затаскиваем шаблон для ContactsViewModel в body</li>
      <li class="next">Мокаем ответ сервера</li>
      <li class="next">Создаем экземпляр ContactsViewModel</li>
      <li class="next">Делаем ko.applyBindings()</li>
      <li class="next">Находим инпут через верстку и меняем его значение</li>
      <li class="next">Эмулируем на инпуте событие change</li>
      <li class="next">Достаем через верстку значения текстов</li>
      <li class="next">Сравниваем значения текстов с ожидаемыми</li>
      <li class="next">Возвращаем моки сервера на место</li>
    </ol>
  </section>
  <section class="slide">
    <img src="pictures/garold.png" alt="" class="cover fill">
    <style type="text/css">
      .slide .fill {
          width: 100%;
          max-width: 200%;
          max-height: 200%;
      }
    </style>
  </section>
  <section class="slide">
    <h2>Верстка и сеть - Правильный тест</h2>
    <ol style="margin-top: -1em">
      <li class="next">Создаем экземпляр ContactsViewModel, передавая ответ через параметр</li>
      <li class="next">Меняем значение поисковой строки через setter ContactsViewModel</li>
      <li class="next">Достаем значения текстов через getter ContactsViewModel</li>
      <li class="next">Сравниваем значения текстов с ожидаемыми</li>
    </ol>
  </section>
  <section class="slide">
    <h2>Верстка и сеть - getter/setter</h2>
    <table>
    <tr>
      <th scope="col"></th>
      <th>getter</th>
      <th>setter</th>
    </tr>
    <tr>
      <th scope="row">React</th>
      <td>comp.state.myProp</td>
      <td>comp.setState({ myProp: 'new value' })</td>
    </tr>
    <tr>
      <th scope="row">Angular</th>
      <td>$scope.myProp</td>
      <td>$scope.myProp = 'new value'</td>
    </tr>
    <tr>
      <th scope="row">Knockout</th>
      <td>viewModel.myProp()</td>
      <td>viewModel.myProp('new value')</td>
    </tr>
    <tr>
      <th scope="row">Backbone</th>
      <td>model.get('myProp')</td>
      <td>model.set('myProp', 'new value')</td>
    </tr>
    </table>
  </section>
  <section class="slide">
    <h2>Верстка и сеть - паттерн Page Object</h2>
    Описывает типовые действия с компонентом:
    <ol>
      <li>Нахождение компонента</li>
      <li>Получение какого-то значения элемента (текст, атрибут)</li>
      <li>Произведение действия над компонентом:
        <ul>
          <li>Клики</li>
          <li>Редактирование</li>
        </ul>
      </li>
    </ul>
  </section>
  <section class="slide">
    <h2>Верстка и сеть - паттерн Page Object</h2>
    <pre><code class="javascript">
test() {
    formPageObject.togglePartnersCheckbox();
    formPageObject.avitoBalloon().hide();
    formPageObject.<mark>toggleAvitoCheckbox</mark>();
    assert(formPageObject.avitoBalloon().visible === false);
}
    </code></pre>
    <div class="next">
      В коде Page Object:
      <pre><code class="javascript">
toggleAvitoCheckbox() {
    this.avito().action.toggle.call(this.avito());
    basis.asap.process();
}
      </code></pre>
    </div>
  </section>
  <section class="slide">
    <h2>Верстка и сеть - Советы</h2>
    <ol>
      <li class="next">Выносите больше логики из представления в JS-модуль</li>
      <li class="next">Тестируйте через методы и свойства JS-модуля, а не через верстку/сеть</li>
      <li class="next">Перепишите тест на функциональный</li>
      <li class="next">При необходимости используйте Page Object</li>
    </ol>
  </section>
  <section class="slide"><div>
    <h2 class="shout">Асинхронный код</h2>
  </div></section>
  <section class="slide">
    <h2>Асинхронный код - Код</h2>
    <pre style="margin-top: -1em;"><code class="javascript">
class SearchForm extends React.Component {
  constructor(props) {
    this.handleChange =
      _.debounce(this.handleChange.bind(this), 200);
  }
  renderInput() {
    return &lt;input ref="query" onChange={this.handleChange}/&gt;;
  }
  handleChange() {
    this.setState({ state: 'loading' });
    fetchResults(this.refs.query.value).then(results => {
      this.setState({ state: 'loaded', results });
    });
  }
}
    </code></pre>
  </section>
  <section class="slide">
    <h2>Асинхронный код - Тест</h2>
    <ol>
      <li class="next">Мокаем ответ сервера</li>
      <li class="next">Заменить реальный таймер поддельным</li>
      <li class="next">Изменить значение инпута</li>
      <li class="next">Вызвать handleChange</li>
      <li class="next">Послать поддельному таймеру сигнал о прохождении 200 мс</li>
      <li class="next">Проверить state</li>
      <li class="next">Вернуть реальный таймер на место</li>
      <li class="next">Возвращаем моки сервера на место</li>
    </ol>
  </section>
  <section class="slide">
    <h2>Асинхронный код - Правильный код</h2>
      <pre style="margin-top: -1em;"><code class="javascript">
class SearchForm extends React.Component {
  constructor(props) {
    this.handleChange =
      _.debounce(this.handleChange.bind(this), 200);
  }
  renderInput() {
    return &lt;input ref="query" onChange={this.handleChange}/&gt;;
  }
  handleChange() {
    this.setState({ state: 'loading' });
    fetchResults(this.refs.query.value).then(results => {
      this.setState({ state: 'loaded', results });
    });
  }
}
    </code></pre>
  </section>
  <section class="slide">
    <h2>Асинхронный код - Правильный код</h2>
      <pre style="margin-top: -1em;"><code class="javascript">
class SearchForm extends React.Component {
  constructor(props) {
    this.debouncedHandleChange =
      _.debounce(this.handleChange.bind(this), 200);
  }
  renderInput() {
    return &lt;input ref="query" onChange={this.debouncedHandleChange}/&gt;;
  }
  handleChange() {
    this.setState({ state: 'loading' });
    fetchResults(this.refs.query.value).then(results => {
      this.setState({ state: 'loaded', results });
    });
  }
}
    </code></pre>
  </section>
  <section class="slide">
    <h2>Асинхронный код - Правильный тест</h2>
    <ol>
      <li class="next">Замокать ответ сервера</li>
      <li class="next">Изменить значение инпута</li>
      <li class="next">Вызвать метод handleChange</li>
      <li class="next">Проверить state</li>
      <li class="next">Вернуть моки сервера на место</li>
    </ol>
  </section>
  <section class="slide">
    <h2>Асинхронный код - Советы</h2>
    <ol>
      <li class="next">Отделите тестируемую логику от кода асинхронных библиотек</li>
      <li class="next">Тестируйте скрытую логику отдельно</li>
      <li class="next">Тестируйте асинхронные библиотеки отдельно</li>
    </ol>
  </section>
  <section class="slide">
    <h2>Слишком сложный тест - Опасность</h2>
    <ol>
      <li class="next">Большие затраты</li>
      <li class="next">Отключение существующего теста</li>
      <li class="next">Прекращение тестирования компонентов</li>
    </ol>
  </section>
  <section class="slide"><div>
    <h2 class="shout">Короче, Склифосовский</h2>
  </div></section>
  <section class="slide"><div>
    <h2 class="shout">Оправдывает ли тест свое написание?</h2>
  </div></section>
  <section class="slide">
    <h2>Критерии оценки</h2>
    <ol>
      <li class="next">Критерии против написания теста
        <ul>
          <li class="next">Сложность написания теста</li>
          <li class="next">Сложность поддержки теста</li>
        </ul>
      </li>
      <li class="next">За написание теста
        <ul>
          <li class="next">Стоимость ошибки</li>
          <li class="next">Вероятность ошибки</li>
        </ul>
      </li>
    </ol>
  </section>
  <section class="slide"><div>
    <h2 class="shout">Вероятность ошибки</h2>
  </div></section>
  <section class="slide">
    <h2>Поводы написать тест</h2>
    <ol>
      <li class="next">console.log</li>
      <li class="next">debugger</li>
      <li class="next">Внутреннее ощущение запутанности</li>
    </ol>
  </section>
  <section class="slide"><div>
    <h2 class="shout">... (гифка запутанности)</h2>
  </div></section>
  <section class="slide">
    <h2>Поводы написать тест</h2>
    <center>
      <img src="pictures/ps.gif" width="820">
    </center>
  </section>
  <section class="slide" style="background-color: black;">
    <img src="pictures/cat.jpg" class="cover">
  </section>
  <section class="slide active" id="ThankYou"><div>
    <h2>Спасибо за внимание!</h2>
    <p>Иван Стрелков, Avito</p>
    <ul>
      <li><a href="https://github.com/istrel">github.com/istrel</a></li>
      <li><a href="https://twitter.com/i_strel">twitter.com/i_strel</a></li>
      <li><a href="mailto:iv-strelkov@yandex.ru">iv-strelkov@yandex.ru</a></li>
    </ul>
    <p>
      Презентация: <a href="https://istrel.github.io/">istrel.github.io</a>
    </p>
    <style>
      #ThankYou img {
        position: absolute;
        top: 200px;
        right: 100px;
        height: 300px;
      }
    </style>
  </div></section>
  <!--
    To hide progress bar from entire presentation
    just remove “progress” element.
    -->
  <div class="progress"></div>
  <script src="shower/shower.min.js"></script>
  <!-- Copyright © 2015 Yours Truly, Famous Inc. -->
  <!-- Photos by John Carey, fiftyfootshadows.net -->
  <script src="highlight/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
